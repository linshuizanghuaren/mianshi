# 闭包

## 什么是闭包

简单讲，闭包就是指有权访问另一个函数作用域中的变量的函数。

MDN 上面这么说：闭包是一种特殊的对象。

它由两部分构成：函数，以及创建该函数的环境。环境由闭包创建时在作用域中的任何局部变量组成。

这种官方的概念是比较难理解的，在面试的时候说出来也不是很专业，因为没办法有个具体的逻辑。

我个人认为，理解闭包的关键在于：外部函数调用之后其变量对象本应该被销毁，但闭包的存在使我们仍然可以访问外部函数的变量对象，这就是闭包的重要概念。

## 产生一个闭包

创建闭包最常见方式，就是在一个函数内部创建另一个函数。下面例子中的 closure 就是一个闭包

```js
function func(){
  var a = 1, b = 2;
  function closure(){ // 闭包
    return a + b;
  }
  return closure; // 返回闭包函数
}
```

闭包的作用域链包含着它自己的作用域，以及包含它的函数的作用域和全局作用域

## 闭包注意事项

通常，函数的作用域及其所有变量都会在函数执行结束后被销毁。但是，在创建了一个闭包以后，这个函数的作用域就会一直保存到闭包不存在为止。

## 闭包中的this对象

```js
var name = "window"
var obj = {
  name: "object",
  getName: function () {
    return function () {
      return this.name;
    }
  }
}
console.log(obj.getName()()); // window
// obj.getName()()实际上是在全局作用域中调用了匿名函数，this指向了window
// window才是匿名函数功能执行的环境
```

```js
var name = "window"
var obj = {
  name: "object",
  getName: function () {
    var that = this;
    return function () {
      return that.name;
    }
  }
}
console.log(obj.getName()()); // object
```

## 闭包的应用

应用闭包的主要场合是：设计私有的方法和变量。

任何在函数中定义的变量，都可以认为是私有变量，因为不能在函数外部访问这些变量。私有变量包括函数的参数、局部变量和函数内定义的其他函数。

把有权访问私有变量的公有方法称为特权方法（privileged method）

在这里，我们需要理解两个概念：

模块模式（The Module Pattern）：为单例创建私有变量和方法。

单例（singleton）：指的是只有一个实例的对象。JavaScript 一般以对象字面量的方式来创建一个单例对象。

匿名函数最大的用途是创建闭包，并且还可以构建命名空间，以减少全局变量的使用。从而使用闭包模块化代码，减少全局变量的污染。

## 运用闭包的关键

闭包引用外部函数变量对象的值
在外部函数的外部调用闭包

## 闭包的缺陷

闭包的缺点就是常驻内存会增大内存使用量，并且使用不当很容易造成内存泄露。

如果不是因为某些特殊任务而需要闭包，在没有必要的情况下，在其它函数中创建函数是不明智的，因为闭包对脚本性能具有负面影响，包括处理速度和内存消耗
